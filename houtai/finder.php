<?php
//Copyright (c) 2016 iFeiwu.com
 class Finder extends Ifeiwu { private $root = "\x64\x61\x74\141\57\x66\151\x6e\x64\x65\162\x2f"; function __construct() { goto WHn8N; ToAdG: XMK6o: goto lqNVx; lqNVx: parent::__construct(); goto ia___; WHn8N: if ($this->table) { goto XMK6o; } goto DLocC; DLocC: $this->table = "\x66\x69\156\144\145\162"; goto ToAdG; ia___: } protected function postAll($pid, $request_data) { goto NvGg1; P55CJ: $level = $this->db->select($this->table, "\x6c\x65\x76\145\x6c")->where(array("\151\x64", "\x3d", $pid))->get(0); goto O3ZgZ; UxOXW: return array("\x66\x69\154\145\x73" => $files, "\x70\141\x74\x68\x73" => $paths); goto NZDSF; qbdaR: if (!$pid) { goto Tm3Jm; } goto P55CJ; wm6FT: $paths = array(); goto qbdaR; KjT1T: Tm3Jm: goto UxOXW; O3ZgZ: $level = array_filter(explode("\54", $level)); goto RZNq6; NvGg1: $files = $this->db->select($this->table)->where($request_data["\167\x68\x65\162\145"])->order($request_data["\157\x72\144\x65\x72"])->all(); goto wm6FT; RZNq6: $paths = $this->db->select($this->table, array("\151\144", "\x6e\141\x6d\x65"))->where(array("\x69\144", "\x49\x4e", $level), "\x41\116\104", array("\x74\x79\160\x65", "\75", "\146\157\x6c\144\x65\162"))->all(); goto KjT1T; NZDSF: } protected function postAdd($request_data) { goto b6y7O; e2Viu: $data["\x70\141\164\150"] = $path; goto foVb1; g628O: $data["\x63\164\151\155\x65"] = time(); goto xDKjx; bESXH: if (mkdir($this->_UTF82GBK("\x2e\56\57" . $path), 511, true)) { goto tSApW; } goto V7dME; x8OAl: $name = $request_data["\x6e\x61\x6d\x65"]; goto hnsdP; s3raM: $level = $this->_getLevel($id); goto gHdMH; mMWVV: if (is_dir($this->_UTF82GBK("\56\x2e\x2f" . $path))) { goto Te514; } goto bESXH; RyOM1: tSApW: goto JaEQd; gHdMH: if (!$this->db->update($this->table, array("\x6c\x65\x76\145\x6c" => $level), array("\151\x64", "\x3d", $id))->is()) { goto WUkt7; } goto oi1Lu; QHrzE: $data["\167\151\x64\x74\x68"] = $imagesize[0]; goto mJh72; Omdvh: $data["\164\171\160\145"] = $type; goto aMrpV; x_Svd: return $this->error("\xe4\xb8\212\344\xbc\240\346\226\207\xe4\273\266\x20" . $name . "\x20\345\244\261\xe8\264\245\357\xbc\201"); goto zBpFe; WVDLg: unlink($filename); goto AlBAq; zBpFe: PJBdw: goto s3raM; ULFv_: WUkt7: goto t6KNi; f3t76: zEfBN: goto e2Viu; mJh72: $data["\150\x65\151\147\150\164"] = $imagesize[1]; goto f3t76; aMrpV: $data["\160\x69\x64"] = $foid ? $foid : 0; goto RNray; b6y7O: $path = $request_data["\x70\141\x74\x68"]; goto x8OAl; V7dME: return $this->error("\345\x88\233\xe5\xbb\xba\xe6\226\207\xe4\273\xb6\xe5\xa4\271\xe5\xa4\261\350\xb4\xa5\357\xbc\201"); goto RyOM1; qjSg_: $imagesize = getimagesize($filename); goto QHrzE; Jun2m: $this->db->beginTransaction(); goto nyHw9; EsU3j: $foid = $request_data["\x66\x6f\x69\144"]; goto mMWVV; AlBAq: $this->db->rollBack(); goto x_Svd; KVjst: $filename = $this->_UTF82GBK("\x2e\x2e\x2f" . $path . $name); goto IzGyF; xDKjx: $data["\145\170\164"] = end(explode("\x2e", $name)); goto Jun2m; t6KNi: $this->db->rollBack(); goto LMY29; nyHw9: if ($id = $this->db->insert($this->table, $data)->id()) { goto PJBdw; } goto WVDLg; foVb1: $data["\x6e\x61\155\145"] = $name; goto Omdvh; RNray: $data["\x73\151\172\145"] = $request_data["\x73\151\x7a\x65"]; goto g628O; oi1Lu: $this->db->commit(); goto u9K9h; hnsdP: $type = mime_content_type("\x2e\56\57" . $path . $name); goto EsU3j; IzGyF: if (!(stripos($type, "\151\x6d\141\x67\145") !== false && is_file($filename))) { goto zEfBN; } goto qjSg_; JaEQd: Te514: goto KVjst; LMY29: return $this->error("\344\xb8\212\344\274\xa0\xe6\x96\x87\xe4\xbb\xb6\x20" . $name . "\x20\xe5\xa4\xb1\xe8\xb4\245\xef\274\x81"); goto l2TUD; u9K9h: return $this->success(); goto ULFv_; l2TUD: } protected function postMkdir($request_data) { goto p_Npq; BXnR4: if (!($name === null || $name === '')) { goto vQJqs; } goto Cbilu; qFBp3: $this->db->rollBack(); goto ARvj5; NpMbN: $data["\143\x74\x69\x6d\145"] = time(); goto EF00P; YczR3: wBlMv: goto VriYf; OhwrR: $data["\x73\x6f\162\x74\142\171"] = 1; goto KJOJ0; rINyn: return $this->success(); goto o9ZDX; NfgHo: $data["\156\x61\x6d\145"] = $name; goto ekSxt; VriYf: if (mkdir($dirname, 493, true)) { goto THYsZ; } goto VaKX9; ekSxt: $data["\x70\151\144"] = $pid; goto Czc6g; JZlYO: $this->db->beginTransaction(); goto o8e1U; ynGCP: $level = $this->_getLevel($id); goto NE0_X; Czc6g: $folder_path = ''; goto wdm4x; O3YUz: goto bqdoh; goto fCW6Z; NE0_X: if ($this->db->update($this->table, array("\154\145\x76\145\154" => $level), array("\151\x64", "\x3d", $id))->is()) { goto FazL2; } goto PyZFZ; TS_nL: $name = $request_data["\x6e\141\155\x65"]; goto BXnR4; o9ZDX: bqdoh: goto KEbo0; K6bMB: $level = array_filter(explode("\x2c", $level)); goto X_33z; sv9_w: aoQEw: goto Zz1FG; o8e1U: $data["\x70\141\x74\150"] = $this->root . $folder_path; goto OhwrR; Oqxpc: $this->db->commit(); goto rINyn; ARvj5: return $this->error("\345\x88\233\xe5\xbb\xba\346\226\x87\344\xbb\xb6\xe5\xa4\xb9\345\xa4\261\350\xb4\245\xef\274\201"); goto vO3vm; HuUXx: if (!$level) { goto BANyQ; } goto K6bMB; Cbilu: return $this->error("\xe6\227\240\346\225\x88\347\x9a\204\345\x8f\x82\xe6\x95\260\xef\xbc\x81"); goto yVbcb; yVbcb: vQJqs: goto FL1eP; wdm4x: $level = $this->db->select($this->table, "\x60\154\145\166\x65\154\140")->where(array("\151\x64", "\75", $pid))->get(0); goto HuUXx; BMynS: rmdir($dirname); goto qFBp3; PyZFZ: rmdir($dirname); goto l4T7k; ukOSk: return $this->error("\345\x88\x9b\345\xbb\xba\346\226\207\344\273\xb6\345\xa4\xb9\xe5\xa4\xb1\350\xb4\xa5\357\xbc\201"); goto O3YUz; p_Npq: $pid = $request_data["\160\151\144"]; goto TS_nL; wkbCy: return $this->error($name . "\40\xe6\226\207\344\xbb\266\345\244\xb9\xe5\267\262\345\xad\x98\xe5\x9c\xa8\357\xbc\201"); goto YczR3; vO3vm: DkADO: goto ynGCP; DYoyt: if (!is_dir($dirname)) { goto wBlMv; } goto wkbCy; oG6xu: THYsZ: goto JZlYO; XjIjs: foreach ($folder as $value) { $folder_path .= $value["\x6e\x61\155\x65"] . "\x2f"; o5agA: } goto sv9_w; X_33z: $folder = $this->db->select($this->table, "\x60\156\141\x6d\x65\140")->where(array("\x69\144", "\111\116", $level), "\x41\116\x44", array("\164\x79\160\x65", "\x3d", "\x66\157\x6c\x64\x65\x72"))->all(); goto XjIjs; VaKX9: return $this->error("\xe5\210\233\345\xbb\272\346\226\207\xe4\xbb\266\345\244\xb9\xe5\xa4\261\350\xb4\245\357\274\x81"); goto oG6xu; l4T7k: $this->db->rollBack(); goto ukOSk; Zz1FG: BANyQ: goto OVW3v; OVW3v: $dirname = $this->_UTF82GBK("\x2e\x2e\57" . $this->root . $folder_path . $name); goto DYoyt; FL1eP: $data = array(); goto NfgHo; KJOJ0: $data["\x74\x79\160\x65"] = "\146\x6f\154\x64\145\x72"; goto NpMbN; fCW6Z: FazL2: goto Oqxpc; EF00P: if ($id = $this->db->insert($this->table, $data)->id()) { goto DkADO; } goto BMynS; KEbo0: } protected function postRename($request_data) { goto xYeNU; WwNZs: return $this->success(); goto uc1sk; rLWHO: lAuLF: goto JVpa8; LdYya: if (!(!$path || stripos($path, $this->root) === false)) { goto Ybxag; } goto U0sLN; Hp6ng: wzBOX: goto IL8AK; uwzmf: vNNcd: goto AXB_p; mK1fs: if ($is_path_update !== false) { goto lAuLF; } goto HKkPQ; YU5vn: goto LhsEe; goto uwzmf; twpF9: $this->db->rollBack(); goto sfmc1; iYGsD: return $this->error("\xe6\x96\207\xe4\xbb\xb6\xe5\244\271\xe9\x87\x8d\345\221\275\345\220\x8d\xe5\xa4\xb1\350\264\245\357\xbc\201"); goto M5UWg; uc1sk: FNypi: goto hHmW8; xYeNU: $id = $request_data["\151\x64"]; goto MmhKT; FJq0_: LhsEe: goto eP3oF; L6xcy: QHw5c: goto BKF8R; BU67c: return $this->error("\346\226\x87\344\273\xb6\xe9\207\215\345\221\xbd\xe5\x90\x8d\345\xa4\261\350\264\245\xef\274\x81"); goto gFm7j; MmhKT: $name = $request_data["\x6e\x61\155\x65"]; goto f8u5H; kjQOp: $oldname = $this->_UTF82GBK("\56\x2e\x2f" . $path . $finder["\x6e\x61\155\x65"]); goto ePYvT; U0sLN: return $this->error("\346\227\240\xe6\x95\210\xe7\232\x84\xe8\267\xaf\345\xbe\x84\xef\xbc\x81"); goto fSmPK; VPT5Z: return $this->error($name . "\40\xe6\226\x87\xe4\xbb\xb6\xe5\244\271\xe5\xb7\262\345\255\230\345\234\250\xef\274\201"); goto YU5vn; ZFCPR: $this->db->rollBack(); goto iYGsD; UFJwe: goto oWgCu; goto L6xcy; ePYvT: $newname = $this->_UTF82GBK("\x2e\56\x2f" . $path . $name); goto GBAap; gFm7j: goto oFy4K; goto oJUMk; N6m3X: $this->db->rollBack(); goto BU67c; f8u5H: if (!(!$id || $name === null || $name === '')) { goto wzBOX; } goto gHEI7; Xdj_U: itv4i: goto FJq0_; AXB_p: $sublist = $this->db->select($this->table, array("\151\x64", "\x6c\145\166\x65\154", "\x74\x79\160\145"))->where(array("\154\x65\166\x65\x6c", "\x4c\x49\x4b\105", "\x25\54{$id}\x2c\x25"))->all(); goto GkqEZ; BKF8R: if (rename($oldname, $newname)) { goto vNNcd; } goto Yd63s; AdzM8: return $this->error("\xe6\x96\x87\344\xbb\266\xe5\244\xb9\xe9\207\x8d\345\x91\xbd\xe5\x90\215\345\xa4\261\350\xb4\245\357\xbc\x81"); goto UFJwe; X3M1k: return $this->success(); goto Xdj_U; JVpa8: $this->db->commit(); goto X3M1k; AofsX: $this->db->commit(); goto WwNZs; oJUMk: E68dX: goto yJWSY; knvoV: if ($this->db->update($this->table, array("\156\141\x6d\x65" => $name), array("\151\x64", "\75", $id))->is()) { goto E68dX; } goto N6m3X; GBAap: $this->db->beginTransaction(); goto YJatt; gHEI7: return $this->error("\346\227\xa0\xe6\x95\210\347\232\x84\xe5\x8f\202\xe6\x95\260\357\274\201"); goto Hp6ng; eP3oF: oWgCu: goto T6wjF; bkn03: if (is_dir($oldname)) { goto AmrQj; } goto tgMv0; hHmW8: oFy4K: goto G9Hcp; tgMv0: return $this->error("\346\211\276\xe4\xb8\215\345\x88\xb0\351\x87\x8d\xe5\x91\xbd\345\220\215\347\232\204\346\x96\207\344\273\266\57\346\226\x87\xe4\xbb\xb6\345\244\271\xef\xbc\201"); goto jtEU8; qETH9: AmrQj: goto hBuOI; jtEU8: goto CtGOl; goto LBX0q; fSmPK: Ybxag: goto kjQOp; PnnSE: goto FNypi; goto C5nVG; WCWeD: $path = $finder["\160\141\164\x68"]; goto LdYya; YJatt: if (is_file($oldname)) { goto HZftu; } goto bkn03; C5nVG: ahkYt: goto AofsX; G9Hcp: goto CtGOl; goto qETH9; sfmc1: return $this->error("\xe6\x96\x87\xe4\xbb\xb6\xe9\x87\215\xe5\x91\xbd\xe5\220\x8d\xe5\xa4\261\350\264\xa5\357\xbc\201"); goto PnnSE; YIaVa: CcegW: goto mK1fs; HKkPQ: rename($newname, $oldname); goto ZFCPR; IL8AK: $finder = $this->db->select($this->table, array("\x70\141\164\x68", "\156\141\x6d\145", "\154\145\166\145\154"))->where(array("\151\x64", "\75", $id))->get(); goto WCWeD; yJWSY: if (rename($oldname, $newname)) { goto ahkYt; } goto twpF9; GkqEZ: foreach ($sublist as $sub) { goto sv6cW; sv6cW: if (!($sub["\x6c\145\166\145\x6c"] == $finder["\x6c\145\166\145\x6c"])) { goto STLoE; } goto BhvY8; V4WA2: eMRdr: goto L306V; n1VKf: $newpath = ''; goto tk_LW; y1MvY: foreach ($level as $lid) { goto V2OV6; JnP0b: $level_name = $levelobj["\156\x61\x6d\x65"]; goto yLYbn; V2OV6: $levelobj = $this->db->select($this->table, array("\156\x61\x6d\145", "\154\x65\x76\x65\154"))->where("\x69\x64\x20\75\40{$lid}\40\x41\116\104\40\164\171\x70\x65\x20\x3d\x20\x27\146\x6f\x6c\x64\x65\x72\47")->get(); goto dc0Na; POr2M: goto YrEGh; goto NxfUI; yLYbn: $newpath .= $level_name != '' ? $level_name . "\57" : ''; goto l72Pp; dc0Na: if (!($sub["\x74\x79\160\145"] == "\146\157\154\x64\145\x72" && $sub["\x6c\x65\x76\145\154"] == $levelobj["\154\x65\x76\145\x6c"])) { goto tgKxq; } goto POr2M; l72Pp: YrEGh: goto pkCtf; NxfUI: tgKxq: goto JnP0b; pkCtf: } goto exn0O; L306V: BN1en: goto TeOzU; oI72Y: goto CcegW; goto V4WA2; BhvY8: goto BN1en; goto yY6SU; Qvaty: if (!($is_path_update === false)) { goto eMRdr; } goto oI72Y; yY6SU: STLoE: goto n1VKf; faYIi: $is_path_update = $this->db->update($this->table, array("\160\x61\164\150" => $this->root . $newpath), array("\x69\x64", "\75", $sub["\x69\144"]))->is(); goto Qvaty; exn0O: oFMfM: goto faYIi; tk_LW: $level = array_filter(explode("\54", $sub["\x6c\145\166\x65\154"])); goto y1MvY; TeOzU: } goto YIaVa; LBX0q: HZftu: goto knvoV; T6wjF: CtGOl: goto Zt_Wi; hBuOI: if ($this->db->update($this->table, array("\156\141\155\145" => $name), array("\x69\144", "\x3d", $id))->is()) { goto QHw5c; } goto FITmp; Yd63s: $this->db->rollBack(); goto VPT5Z; M5UWg: goto itv4i; goto rLWHO; FITmp: $this->db->rollBack(); goto AdzM8; Zt_Wi: } protected function postIsFile($request_data) { goto q2HSn; q2HSn: $path = $request_data["\x70\x61\164\150"]; goto eI2ri; q9Crk: return $this->error($name . "\x20\346\x96\207\344\273\xb6\344\270\x8d\xe5\xad\230\345\x9c\250\357\274\201"); goto F_tOe; XWZ8t: return $this->success($name . "\40\346\226\207\xe4\273\xb6\xe5\xb7\xb2\345\xad\x98\345\234\250\357\xbc\201"); goto OFKv2; XuSIK: n_0tk: goto XWZ8t; l73oL: if (file_exists($this->_UTF82GBK("\x2e\x2e\57" . $path . $name))) { goto n_0tk; } goto q9Crk; F_tOe: goto u4nu0; goto XuSIK; OFKv2: u4nu0: goto E8kzZ; eI2ri: $name = $request_data["\x6e\141\x6d\x65"]; goto l73oL; E8kzZ: } protected function postDelete($request_data) { goto JdUwA; JdUwA: $ids = $request_data["\151\144"]; goto L34ao; APPRR: AJbD5: goto lOY5a; L34ao: foreach ($ids as $id) { goto zMsAc; dSBwc: xDn6p: goto LNf2r; cinQ5: $this->db->delete($this->table, array("\x6c\145\x76\x65\154", "\114\x49\x4b\x45", "\45\54{$id}\54\x25")); goto M846V; Prb34: if (is_file($filename)) { goto MArVN; } goto eVfm7; eZmE9: $this->db->delete($this->table, array("\x69\x64", "\75", $id))->is(); goto id8Hf; mZbVK: @unlink($filename); goto lHtcG; CRBsd: if (!$this->db->delete($this->table, array("\x69\144", "\x3d", $id))->is()) { goto lFwYe; } goto mZbVK; OWttB: NLhXl: goto YX4h3; H3mDs: MArVN: goto CRBsd; zMsAc: $file = $this->db->select($this->table, array("\160\x61\164\x68", "\156\x61\x6d\145"))->where(array("\x69\144", "\75", $id))->get(); goto BPpV8; id8Hf: goto NLhXl; goto at18n; BPpV8: if ($file) { goto xDn6p; } goto BHJLo; lHtcG: lFwYe: goto h8S91; GH6cR: JAWAI: goto aocAf; qlJMb: $name = $file["\x6e\x61\x6d\x65"]; goto W6l60; h8S91: goto JB833; goto GH6cR; BHJLo: goto NLhXl; goto dSBwc; GPKtM: n7zj7: goto JLZkl; ASyA8: $this->_rmdir($filename); goto GPKtM; JLZkl: JB833: goto OWttB; at18n: Ev1nn: goto bx6bj; aocAf: if (!$this->db->delete($this->table, array("\x6c\145\166\x65\154", "\x4c\x49\x4b\105", "\45\54{$id}\x2c\x25"))->is()) { goto n7zj7; } goto ASyA8; M846V: goto JB833; goto H3mDs; bx6bj: $filename = $this->_UTF82GBK("\56\56\57" . $path . $name); goto Prb34; LNf2r: $path = $file["\x70\x61\164\150"]; goto qlJMb; W6l60: if (!(!$path || stripos($path, "\x64\141\x74\x61\57\x66\151\156\144\x65\x72\x2f") === false || $name == null || $name == '')) { goto Ev1nn; } goto eZmE9; eVfm7: if (is_dir($filename)) { goto JAWAI; } goto cinQ5; YX4h3: } goto APPRR; lOY5a: return $this->success(); goto j1bFH; j1bFH: } protected function getCurPath($foid) { goto PgsF_; uGPkb: return $this->success('', $data); goto ivFqZ; BBj9_: $level = array_filter(explode("\54", $level)); goto sPoCY; sPoCY: $data = $this->db->select($this->table, array("\x69\144", "\156\x61\x6d\145"))->where(array(array("\x69\x64", "\x49\x4e", $level), "\101\116\104", array("\164\171\160\145", "\x3d", "\146\157\x6c\x64\145\162")))->all(); goto uGPkb; PgsF_: $level = $this->db->select($this->table, "\x6c\x65\166\145\154")->where(array("\x69\144", "\x3d", $foid))->get(0); goto BBj9_; ivFqZ: } }
